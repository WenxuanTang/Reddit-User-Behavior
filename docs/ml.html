<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ANLY502 Group 21">

<title>Milestone 3: Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="ml_files/libs/clipboard/clipboard.min.js"></script>
<script src="ml_files/libs/quarto-html/quarto.js"></script>
<script src="ml_files/libs/quarto-html/popper.min.js"></script>
<script src="ml_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ml_files/libs/quarto-html/anchor.min.js"></script>
<link href="ml_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ml_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="ml_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="ml_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ml_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ml_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="ml_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pages" id="toc-pages" class="nav-link active" data-scroll-target="#pages">Pages</a></li>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#analysis-report" id="toc-analysis-report" class="nav-link" data-scroll-target="#analysis-report">Analysis Report</a></li>
  <li><a href="#business-goal-1-what-posts-are-more-likely-to-be-gilded" id="toc-business-goal-1-what-posts-are-more-likely-to-be-gilded" class="nav-link" data-scroll-target="#business-goal-1-what-posts-are-more-likely-to-be-gilded">Business goal 1: What posts are more likely to be gilded?</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a></li>
  <li><a href="#machine-learning-model" id="toc-machine-learning-model" class="nav-link" data-scroll-target="#machine-learning-model">Machine Learning Model</a></li>
  <li><a href="#result-evaluation" id="toc-result-evaluation" class="nav-link" data-scroll-target="#result-evaluation">Result Evaluation</a></li>
  </ul></li>
  <li><a href="#business-goal-4-what-kind-of-accounts-are-more-likely-to-be-cancelled" id="toc-business-goal-4-what-kind-of-accounts-are-more-likely-to-be-cancelled" class="nav-link" data-scroll-target="#business-goal-4-what-kind-of-accounts-are-more-likely-to-be-cancelled">Business goal 4: What kind of accounts are more likely to be cancelled?</a>
  <ul class="collapse">
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  <li><a href="#data-preparation-1" id="toc-data-preparation-1" class="nav-link" data-scroll-target="#data-preparation-1">Data Preparation</a></li>
  <li><a href="#feature-engineering-1" id="toc-feature-engineering-1" class="nav-link" data-scroll-target="#feature-engineering-1">Feature Engineering</a></li>
  <li><a href="#machine-learning-model-1" id="toc-machine-learning-model-1" class="nav-link" data-scroll-target="#machine-learning-model-1">Machine Learning Model</a></li>
  <li><a href="#result-evaluation-1" id="toc-result-evaluation-1" class="nav-link" data-scroll-target="#result-evaluation-1">Result Evaluation</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Milestone 3: Machine Learning</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ANLY502 Group 21 </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="pages" class="level1">
<h1>Pages</h1>
<ul>
<li><a href="./index.html">Main Page</a></li>
<li><a href="./eda_1.html"> Exploratory Data Analysis </a><br></li>
<li><a href="./nlp.html"> Natural Language Processing </a><br></li>
<li><a href="./ml.html"> Machine Learning </a><br></li>
<li><a href="./conclusion.html"> Conclusion </a></li>
</ul>
</section>
<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>As the biggest channel on Reddit, the “AskReddit” subreddit contains a huge amount of questions and answers. When people try to dive into this ocean of Q&amp;As, some may want their answers to be more valuable as they could get gilded from the thankful viewers, while others might just want to maintain their manners and become a part of the grand audience. Thus, in order to explore the potential strategies for an AskReddit user to make hot/proper comments, we performed machine learning techniques to drill into two of the business goals proposed earlier:</p>
<ul>
<li><strong>Business goal 1</strong>: What posts are more likely to be gilded and whether controversiality is an important factor to be gilded?</li>
<li><strong>Business goal 4</strong>: What kind of accounts are more likely to be cancelled?</li>
</ul>
<p>With the help of machine learning models and feature importance plots, we conclude that posts with a higher “score”(a feature calculated by subtracting the number of dislikes from the number of likes) are more likely to be gilded and “controversiality” is also an important factor to be considered. Moreover, there are indeed multiple factors influencing the gilded option and we have summarized the top 10 most influential features. At the same time, we also compared the posts of users who have been cancelled with those of normal users. From our model result, we found that cancelled accounts are more likely to post content that has been banned by Reddit moderators. Therefore, Reddit users should be aware of the moderation rules before posting in order to ensure a smooth forum experience and avoid being banned for posting inappropriate content.</p>
</section>
<section id="analysis-report" class="level1">
<h1>Analysis Report</h1>
</section>
<section id="business-goal-1-what-posts-are-more-likely-to-be-gilded" class="level1">
<h1>Business goal 1: What posts are more likely to be gilded?</h1>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>We want to analyze and predict whether a post is gilded. It is obviously a binary classification. To address the first business goal, we build different machine learning models based on comment features and specific text. And finally we found that posts with higher score tend to be more likely to receive gild. The score is an indicator calculated by subtracting the number of dislikes from the number of likes.<br></p>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>In this part, we prepared the dataset including features and label for machine learning model. After checking the distribution of label, We found there is a label imbalance problem. We applied under-sampling method that deleted some data from rows of data from the majority classes to maintain the label balance in training data.</p>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<p>In the feature engineering part, we created 9 new feature including time range of post, sentiment class and body length using NLP pipeline and sentiment analysis. To be more specifically, we applied NLP pipeline to clean ‘body’ feature, build sentiment analysis model to create sentiment class of ‘body’ and used timestamp function to extract the hour and day of week of the comments.</p>
</section>
<section id="machine-learning-model" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning-model">Machine Learning Model</h2>
<p>For the machine learning process, we first applied the 2 models listed below:</p>
<ul>
<li>Random Forest</li>
<li>Logistic Regression</li>
</ul>
<p>These two models are built on the selected comment features including controversiality, whether edited more than once, score, hour, day of week, length of clean body, sentiment class etc. The comments post is split into training and testing datasets. And 5-fold cross-validation is applied to tune the hyperparameters.</p>
<p>Then we applied another 2 models on content of the comment listed below:</p>
<ul>
<li>Support Vector Machine</li>
<li>Random Forest</li>
</ul>
<p>For the SVM model and random forest model, they are both built on the specific content of the comment. We used tf-idf to embed the text vector. And 5-fold cross-validation is also applied to tune the hyperparameters.</p>
</section>
<section id="result-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="result-evaluation">Result Evaluation</h2>
<p>The model performance is evaluated from 4 different perspectives (accuracy, test error, F1 score, and AUC).</p>
<table class="table">
<caption>Result Comparison</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 2%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Model</th>
<th style="text-align: right;">Model Type</th>
<th style="text-align: right;">Accuracy</th>
<th style="text-align: right;">Test Error</th>
<th style="text-align: right;">F1 Score</th>
<th style="text-align: right;">AUC</th>
<th style="text-align: right;">Gilded Accuracy</th>
<th style="text-align: right;">Not gilded Accuracy</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Random Forest Model1</td>
<td style="text-align: right;">based on features</td>
<td style="text-align: right;">0.892878</td>
<td style="text-align: right;">0.107122</td>
<td style="text-align: right;">0.892643</td>
<td style="text-align: right;">0.892758</td>
<td style="text-align: right;">0.847024</td>
<td style="text-align: right;">0.938491</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: right;">Logistic Regression Model</td>
<td style="text-align: right;">based on features</td>
<td style="text-align: right;">0.745689</td>
<td style="text-align: right;">0.254311</td>
<td style="text-align: right;">0.734602</td>
<td style="text-align: right;">0.745153</td>
<td style="text-align: right;">0.541458</td>
<td style="text-align: right;">0.948849</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: right;">SVM Model</td>
<td style="text-align: right;">based on text</td>
<td style="text-align: right;">0.615937</td>
<td style="text-align: right;">0.384063</td>
<td style="text-align: right;">0.587839</td>
<td style="text-align: right;">0.615252</td>
<td style="text-align: right;">0.354544</td>
<td style="text-align: right;">0.875959</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: right;">Random Forest Model2</td>
<td style="text-align: right;">based on text</td>
<td style="text-align: right;">0.609270</td>
<td style="text-align: right;">0.390730</td>
<td style="text-align: right;">0.589340</td>
<td style="text-align: right;">0.608692</td>
<td style="text-align: right;">0.388739</td>
<td style="text-align: right;">0.828645</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>And a confusion matrix is also performed based on the prediction gild amount and the actual gild amount.</p>
<table class="table">
<caption>Random Forest Model based on features</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Gild</th>
<th>Not gild</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Gild</td>
<td>6589</td>
<td>1190</td>
</tr>
<tr class="even">
<td>Not gild</td>
<td>481</td>
<td>7339</td>
</tr>
</tbody>
</table>
<p>In conclusion, the model built on comment features has a higher accuracy compared to those built on a specific text, and the test error rate is also lower. Moreover, the models built on comment features also have a significantly better performance in classifying the “gilded” feature of the post since the prediction accuracy is much higher. <br></p>
<div id="1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./data/plots/ml_analysis_1/ml_analysis1_feature_importance.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">feature importance</figcaption><p></p>
</figure>
</div>
<p>And the feature importances plot reveals the top 10 most important features. Thus, features “score”, “edit”, “length of comment before clean”, “length of comment before clean”, “submitter”, “controversiality”, “positive sentiment”, “negative sentiment”, “hour_16(4pm)”, “Monday” are the top 10 influential factor for the gilded option. Among these top 10 features, “score” has the most impact on the gilded option, while although other features like “Monday” are not as outstanding as “score”, they also have an influence on the gilded option. Overall, posts with controversiality does have an impact on the gilded action, but it is not the main influencing factor. Instead, posts with higher scores tend to be more likely to receive gild.<br></p>
</section>
</section>
<section id="business-goal-4-what-kind-of-accounts-are-more-likely-to-be-cancelled" class="level1">
<h1>Business goal 4: What kind of accounts are more likely to be cancelled?</h1>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">Summary</h2>
<p>After summarizing the gilding pattern of comments, we turned to focus on the pattern of comments whose author’s account got cancelled.<br> To address the second business goal, we decide to first filter the data and then apply different machine learning models based on the generated features. And each model has its own advantage and shortcoming in evaluating the post. Thus, the audience should flexibly choose the model based on their preference. The results suggest that the majority reason for account cancelation is caused by regulation of moderators.</p>
</section>
<section id="data-preparation-1" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation-1">Data Preparation</h2>
<p>In this section, we also took the label imbalance problem into consideration and applied the same method to deal with it.<br> In order to solve the business goal (what kind of account is more likely to be cancelled), our group first decided to obtain the target dataset from posts in the “askreddit” subreddit; while posts made by cancelled users have “[deleted]” as their author, we also filtered out the posts with “[deleted]” for both author and body, since they only indicate that their authors decided to delete the post; after collecting posts from actual cancelled users, we randomly collected similar number of posts whose authors are still active, so our machine learning models could make comparisons to fetch the embedded patterns for actual cancelled users.</p>
</section>
<section id="feature-engineering-1" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering-1">Feature Engineering</h2>
<p>For the stage of feature engineering, while we tagged the removed-by-moderator posts with “[removed]” body as a feature, we wanted to put the messy column of body into usage, so we applied text preprocessing techniques on existing body texts through NLP pipelines(TF-IDF, sentiment model). The TF-IDF pipeline is applied to help identify the commonly-used words in posts with cancelled user, and we manually extract 10 keywords from the top 30 common words, generating a new feature describing existence of these keywords in the body text. Then, the sentiment model is deployed to analyze the sentiment of the posts, which is also included in the dataset as a predictor of the account deletion status.</p>
</section>
<section id="machine-learning-model-1" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning-model-1">Machine Learning Model</h2>
<p>For the machine learning process, we applied three models listed below:</p>
<ul>
<li>Random Forest</li>
<li>Linear Support Vector Machine</li>
<li>Gradient Boosting Tree</li>
</ul>
<p>The posts are split into training, testing and prediction datasets, and the performance of the models is measured in 3 different metrics(accuracy, f1 score, and area under the ROC curve).</p>
</section>
<section id="result-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="result-evaluation-1">Result Evaluation</h2>
<p>The performance of the models is measured in 3 different metrics shown below.</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>model</th>
<th>accuracy</th>
<th>f1 score</th>
<th>ROC area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Random Forest</td>
<td>0.648014</td>
<td>0.616590</td>
<td>0.683513</td>
</tr>
<tr class="even">
<td>Support Vector Machine</td>
<td>0.647531</td>
<td>0.617946</td>
<td>0.682104</td>
</tr>
<tr class="odd">
<td>Gradient Boosted Trees</td>
<td>0.650073</td>
<td>0.627909</td>
<td>0.680772</td>
</tr>
</tbody>
</table>
<p>From our observation on these statistics, the Random Forest model seems to have a better capability at separating the classes with largest area under ROC curve, while the GBT model has the highest actual precision statistics; there is no significant performance difference between the 3 models, and more information may need to be extracted by analyzing their feature importances, which are listed below and visualized as a horizontal bar plot.</p>
<table class="table">
<thead>
<tr class="header">
<th>feature</th>
<th>rf imp</th>
<th>svm imp</th>
<th>gbt imp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>controversiality</td>
<td>5.28e-05</td>
<td>0.442</td>
<td>4.62e-10</td>
</tr>
<tr class="even">
<td>edited</td>
<td>1.91e-04</td>
<td>0.505</td>
<td>2.26e-03</td>
</tr>
<tr class="odd">
<td>gilded</td>
<td>1.84e-06</td>
<td>7.90e-03</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>is_submitter</td>
<td>0.025</td>
<td>0.830</td>
<td>0.080</td>
</tr>
<tr class="odd">
<td>score</td>
<td>2.94e-03</td>
<td>7.69e-10</td>
<td>8.74e-03</td>
</tr>
<tr class="even">
<td>stickied</td>
<td>3.95e-04</td>
<td>0.259</td>
<td>0.011</td>
</tr>
<tr class="odd">
<td>removed_by_mod</td>
<td>0.254</td>
<td>1.106</td>
<td>0.667</td>
</tr>
<tr class="even">
<td>sensitive_words_vec_false</td>
<td>0.058</td>
<td>0.578</td>
<td>6.02e-06</td>
</tr>
<tr class="odd">
<td>sensitive_words_vec_unknown</td>
<td>0.332</td>
<td>1.106</td>
<td>0.220</td>
</tr>
<tr class="even">
<td>sentiment_vec_positive</td>
<td>0.018</td>
<td>0.433</td>
<td>2.48e-04</td>
</tr>
<tr class="odd">
<td>sentiment_vec_negative</td>
<td>0.011</td>
<td>0.433</td>
<td>1.01e-15</td>
</tr>
<tr class="even">
<td>sentiment_vec_unknown</td>
<td>0.295</td>
<td>1.106</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<p><img src="./data/plots/ml_analysis_2/feature_importances.png" id="2" class="img-fluid"></p>
<p>The importances of the Linear SVC model are the absolute values, and the important values have been normalized into a range of [0,1]. Regarding the overall distribution of importance, we could see that:</p>
<ul>
<li>Linear SVC has the most balanced scale of importance, followed by Random Forest; as for the Gradient Boosting Trees model of green bars, the importance seems to concentrate on a few features.</li>
<li>Regarding the single features, we shall see that the unknown features(sentiment_vec_known, sensitive_words_vec_unknown) and removed_by_mod are generally having the largest importances in prediction. Since posts are tagged unknown in sentiment and sensitive words if and only if their body contents got removed by the moderators, these features all indicate that regulation of moderators could be a major factor in the cancellation of Reddit accounts.</li>
<li>As the main ways to measure the value of a post, score and gilded seem to have little importance in predicting account cancellation. This might come from the fact that contents from a cancelled user usually receive low scores(some even get negative scores!) and are not worth being gilded at all.</li>
</ul>
<p>Concluding from these observations, we arrived at a conclusion that regulations from Reddit moderators correlate greatly with the cancellation of accounts, which seems reasonable since the moderators seem to have the power to directly cancel accounts, possibly due to their posting too much inappropriate content and getting reported from the other users. <br> Thus, in order to surf gracefully in the AskReddit channel, one had better follow the rules maintained by moderators and make appropriate posts, so their browsing experiences won’t be ruined by an unhappy ending of their accounts.</p>
<p>Based on the machine learning models and feature importance plots, we concluded the top 10 most influential features of the gilded option. Besides the main component features like “score”, we could also infer that features like “Monday” have a minor influence too. And the reason behind it could be Reddit users are more active on the first day of the week.</p>
<p><a href="./ml_analysis1.html">All source code for ML question 1.</a></p>
<p><a href="./ml_analysis2.html">All source code for ML question 2.</a></p>
<p><a href="./index.html">Go back to main page.</a></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>